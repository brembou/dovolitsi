{{!< default}}

{{#post}}

    {{#if @custom.display_progress_bar}}
        {{> "progress-bar"}}
    {{/if}}

    <article class="gh-article {{post_class}} mt-0">

        <header class="container mb-3 text-center md:mb-8 gh-header">

            <h1 class="max-w-md m-auto mb-2 text-3xl font-bold sm:leading-snug sm:text-3xl lg:max-w-3xl lg:leading-snug lg:text-5xl gh-title font-display">{{title}}</h1>

            {{#if custom_excerpt}}
                <p class="max-w-lg mx-auto mt-8 mb-4 font-normal md:mb-6 md:leading-relaxed md:mt-13 md:text-base lg:max-w-2xl font-text" data-aos="fade-in" data-aos-duration="500" data-aos-delay="150">{{custom_excerpt}}</p>
            {{/if}}

            {{!-- Meta data for post header --}}
            <span class="flex flex-wrap items-center justify-center text-base leading-relaxed text-gray-600 md:leading-none font-display">
                <span class="macaw-post-author">
                    {{#foreach authors}}<a href="/jako-ja/" class="text-gray-900 underline transition-colors duration-300 hover:text-accent">{{name}}</a>{{/foreach}}
                </span>
                <time class="feed-date" datetime="{{date format="DD-MM-YYYY"}}">
                    <span class="mx-2 bull">&bull;</span>
                    {{date published_at format="DD. MMM YYYY"}}
                </time>

                <!--<span class="visibility">
                    <span class="mx-2 bull">&bull;</span>
                    {{visibility}}
                </span>-->

                {{#if reading_time}}
                    <div class="feed-length">
                        <span class="mx-2 bull">&bull;</span>
                        {{reading_time minute="Čtení na minutku" minutes="Čtení na % min"}}
                    </div>
                {{/if}}
            </span>
        </header>

        {{!-- We check if the post has a feature image --}}
        {{#if feature_image}}
            <figure class="container mt-2 text-center md:mb-8 md:mt-10 gh-feature-image max-sm:p-0" data-aos="fade-in" data-aos-duration="500" data-aos-delay="150">

                <picture>
                    <source srcset="{{img_url feature_image size="post-full-s-x2"}} 2x,{{img_url feature_image
                                                                                                 size="post-full-s"}} 1x" media="(max-width: 420px)" />
                    <source srcset="{{img_url feature_image size="post-full-m-x2"}} 2x,{{img_url feature_image
                                                                                                 size="post-full-m"}} 1x" media="(max-width: 768px)" />
                    <source srcset="{{img_url feature_image size="post-full-x2"}} 2x,{{img_url feature_image
                                                                                               size="post-full"}} 1x" media="(max-width: 1024px)" />
                    <img srcset="{{img_url feature_image size="post-full-x2"}} 2x" src="{{img_url feature_image size="post-full"}}" alt="{{#if feature_image_alt}}{{feature_image_alt}}{{else}}{{title}}{{/if}}" class="w-full max-sm:rounded-none max-sm:w-full rounded-3xl" decoding="async" fetchpriority="high" />

                </picture>
                {{#if feature_image_caption}}
                    <figcaption>{{feature_image_caption}}</figcaption>
                {{/if}}
            </figure>
        {{/if}}

        {{!-- Content goes here --}}
        <div class="relative prose sm:prose-lg prose-md prose-headings:font-display prose-headings:mt-0 prose-headings:mb-2 prose-p:mt-0 prose-p:mb-6 sm:prose-p:mb-10 md:prose-p:mb-12 lg:prose-p:mb-14 xl:prose-p:mb-14 prose-h5:font-bold prose-h6:font-bold prose-img:rounded-3xl prose-ul:mt-0 prose-ul:mb-6 sm:prose-ul:mb-10 md:prose-ul:mb-12 lg:prose-ul:mb-14 xl:prose-ul:mb-14 prose-ol:mt-0 prose-ol:mb-6 sm:prose-ol:mb-10 md:prose-ol:mb-12 lg:prose-ol:mb-14 xl:prose-ol:mb-14 prose-li:pl-0 prose-li:mt-0 prose-a:underline hover:prose-a:no-underline prose-hr:mt-0 prose-hr:mb-6 sm:prose-hr:mb-10 md:prose-hr:mb-12 lg:prose-hr:mb-14 xl:prose-hr:mb-14 last:prose-li:mb-0 prose-macaw gh-content gh-canvas max-w-none">

                {{#if @custom.display_toc}}

                    <div class="mb-20 bg-gray-100 rounded-2xl">
                        <div class="px-10 py-8">
                            <h4 class="mb-8 text-xl toc-heading font-display">{{t "Table of contents"}}</h4>
                            <div class="gh-toc font-display"></div>
                        </div>
                    </div>

                {{/if}}

            {{#if access}}

                {{content}}

                {{#if @custom.display_share}}
                    <div class="not-prose">
                        {{> "share"}}
                    </div>
                {{/if}}

                <div class="divider-cherry mt-16"></div>

                {{!-- Hyvor komentáře - pouze v produkci --}}
                {{#match @site.url "!=" "http://localhost:2368"}}
                <section class="gh-post-comments mt-16" id="ghost-comments-root">
                    <!--{{comments}}-->
                    <div id="comments"></div>
                    <script async src="https://talk.hyvor.com/embed/embed.js" type="module"></script>

                    <script>
                        const comments = document.createElement('hyvor-talk-comments');
                        comments.setAttribute('website-id', 14402);
                        comments.setAttribute('page-id', "{{id}}");
                        {{#if @member}}
                        comments.setAttribute('sso-user', JSON.stringify({
                            timestamp: Math.floor(Date.now() / 1000),
                            id: "{{{ @member.uuid }}}",
                            name: "{{{ @member.name }}}" || "{{{ @member.email }}}".split('@')[0] || "Člen",
                            email: "{{{ @member.email }}}",
                            picture_url: "{{{ @member.avatar_image }}}"
                        }))
                        {{/if}}
                        document.getElementById("comments").appendChild(comments);

                        // Inicializace dataLayer
                        window.dataLayer = window.dataLayer || [];

                        // 1. Nový komentář
                        comments.addEventListener('comment:published', function(e) {
                            if (window.dataLayer) {
                                window.dataLayer.push({
                                    'event': 'hyvor_comment',
                                    'comment_id': e.detail.id || '',
                                    'article_url': window.location.href,
                                    'article_title': document.title
                                });
                            }
                        });

                        // 2. Hodnocení komentáře (upvote/downvote)
                        comments.addEventListener('comment:voted', function(e) {
                            if (window.dataLayer) {
                                window.dataLayer.push({
                                    'event': 'hyvor_vote',
                                    'comment_id': e.detail.comment?.id || '',
                                    'vote_type': e.detail.vote || '',
                                    'article_url': window.location.href
                                });
                            }
                        });

                        // 3. REAKCE (emoji)
                        comments.addEventListener('reaction', function(e) {
                            if (window.dataLayer) {
                                window.dataLayer.push({
                                    'event': 'hyvor_reaction',
                                    'reaction_type': e.detail.type || '', // 'superb' | 'love' | 'wow' | 'sad' | 'laugh' | 'angry'
                                    'article_url': window.location.href,
                                    'article_title': document.title
                                });
                            }
                        });

                        // 4. HODNOCENÍ (rating/hvězdičky) - pokud používáte
                        comments.addEventListener('rating', function(e) {
                            if (window.dataLayer) {
                                window.dataLayer.push({
                                    'event': 'hyvor_rating',
                                    'rating_value': e.detail.rating || 0,
                                    'rating_count': e.detail.count || 0,
                                    'rating_average': e.detail.average || 0,
                                    'article_url': window.location.href,
                                    'article_title': document.title
                                });
                            }
                        });
                    </script>
                </section>
                {{/match}}

            {{else}}

                <div class="macaw-post-sneak-peek fading">

                    {{{html}}}

                </div>

                {{> "content-cta"}}

            {{/if}}

            {{#if @custom.display_author_box}}

                <div class="relative px-8 pb-8 md:p-10 overflow-hidden pt-[4.5rem] lg:px-20 lg:pt-20 lg:pb-16 my-7 lg:my-14 grad-bg rounded-3xl macaw-authors not-prose">
                    {{#foreach authors}}
                        {{> "author"}}
                    {{/foreach}}
                </div>

            {{/if}}

            <div>
                {{#is "post"}}
                    <h2 class="no-toc pb-3 mb-16 text-lg md:text-base font-bold leading-none tracking-widest text-gray-900 uppercase border-b featured-title font-display">
                        Nespěcháš? Tak si dej tohle…
                    </h2>

                    {{!-- GRID: články pod sebou (1 sloupec) --}}
                    <div class="grid grid-cols-1 gap-6 md:gap-8 gh-feed recommended-posts" aria-label="Doporučené články">

                        {{!-- ==========================================================
                              SLOT 1: VIP ČLÁNEK (Hledá POUZE v 'members' obsahu)
                              ========================================================== --}}
                        {{!-- 1. Pokus: Náhodný článek pro členy (tím se vyloučí duplicita s veřejnými) --}}
                        {{#get "posts" filter="id:-{{id}}+visibility:members" limit="1" order="random" as |vip|}}
                            {{#if vip}}
                                {{#foreach vip}}
                                    {{> "card-recommended"}}
                                {{/foreach}}
                            {{else}}
                                {{!-- FALLBACK PRO SLOT 1:
                                      Pokud nemáte žádné members články, nebo jste zrovna na jediném z nich.
                                      Musíme sáhnout do veřejných, ale vezmeme 'featured' (Doporučené),
                                      abychom snížili šanci na duplicitu s těmi vedle. --}}
                                {{#get "posts" filter="id:-{{id}}+visibility:public+featured:true" limit="1" order="random" as |fallbackVip|}}
                                    {{#foreach fallbackVip}}
                                        {{> "card-recommended"}}
                                    {{/foreach}}
                            {{else}}
                                {{!-- Poslední záchrana: prostě náhodný veřejný --}}
                                {{#get "posts" filter="id:-{{id}}+visibility:public" limit="1" order="random" as |lastResort|}}
                                    {{#foreach lastResort}}
                                        {{> "card-recommended"}}
                                    {{/foreach}}
                                {{/get}}
                                {{/get}}
                            {{/if}}
                        {{/get}}


                        {{!-- ==========================================================
                              SLOT 2 a 3: SOUVISEJÍCÍ (Hledá POUZE v 'public' obsahu)
                              ========================================================== --}}
                        {{!-- Tím, že hledáme jen v public, se nemůžeme srazit s VIP kartou (pokud ona našla members) --}}

                        {{#if tags}}
                            {{!-- Máme tagy -> Hledáme související VEŘEJNÉ --}}
                            {{#get "posts" filter="tags:[{{tags[*].slug}}]+id:-{{id}}+visibility:public" limit="2" as |related|}}
                                {{#match pagination.total ">=" 2}}
                                    {{!-- Máme dostatek souvisejících --}}
                                    {{#foreach related}}
                                        {{> "card-recommended"}}
                                    {{/foreach}}
                        {{else}}
                            {{!-- Máme jich málo -> Raději načteme 2 náhodné VEŘEJNÉ --}}
                            {{#get "posts" filter="id:-{{../id}}+visibility:public" limit="2" order="random" as |randoms|}}
                                {{#foreach randoms}}
                                    {{> "card-recommended"}}
                                {{/foreach}}
                            {{/get}}
                                {{/match}}
                            {{/get}}
                        {{else}}
                            {{!-- Nemáme tagy -> Načteme 2 náhodné VEŘEJNÉ --}}
                            {{#get "posts" filter="id:-{{id}}+visibility:public" limit="2" order="random" as |randoms|}}
                                {{#foreach randoms}}
                                    {{> "card-recommended"}}
                                {{/foreach}}
                            {{/get}}
                        {{/if}}

                    </div>

                    {{else}}
                        {{!-- PAGE (Statická stránka): Jednoduchý mix --}}
                        <h2 class="no-toc pb-3 mb-8 text-lg md:text-base font-bold leading-none tracking-widest text-gray-900 uppercase border-b featured-title font-display border-b-gray-200">
                            Vybrala jsem pro tebe…
                        </h2>
                        <div class="grid grid-cols-1 gap-6 md:gap-8 gh-feed recommended-posts" aria-label="Doporučené články">
                            {{#get "posts" limit="3" order="random" as |randoms|}}
                                {{#foreach randoms}}
                                    {{> "card-recommended"}}
                                {{/foreach}}
                            {{/get}}
                        </div>
                {{/is}}
            </div>

            {{#match @site.recommendations_enabled}}
                <div class="mt-12 not-prose flex flex-col">
                    <h3 class="no-toc pb-2 mb-6 text-base font-bold leading-none tracking-widest text-gray-900 uppercase border-b featured-title font-display border-b-gray-200 ">{{t
                            "Recommendations"}}</h3>

                    {{recommendations limit="2"}}
                </div>
            {{/match}}


            <div id="read-depth-trigger"></div>

            <div class="gh-loadmore"></div>


            <noscript>
                <div class="gh-pagination">
                    <div class="gh-loadmore"></div>
                </div>
            </noscript>

        </div>

    </article>

{{/post}}


{{#if @custom.display_toc}}
    {{> "toc"}}
{{/if}}