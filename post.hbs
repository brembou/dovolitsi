{{!< default}}

{{#post}}

    {{#if @custom.display_progress_bar}}
        {{> "progress-bar"}}
    {{/if}}

    <article class="gh-article {{post_class}} mt-0">

        <header class="container mb-3 text-center md:mb-8 gh-header">

            <h1 class="max-w-md m-auto mb-2 text-3xl font-bold sm:leading-snug sm:text-3xl lg:max-w-3xl lg:leading-snug lg:text-5xl gh-title font-display">{{title}}</h1>

            {{#if custom_excerpt}}
                <p class="max-w-lg mx-auto mt-8 mb-4 font-normal md:mb-6 md:leading-relaxed md:mt-13 md:text-base lg:max-w-2xl font-text">{{custom_excerpt}}</p>
            {{/if}}

            {{!-- Meta data for post header --}}
            <span class="flex flex-wrap items-center justify-center text-base leading-relaxed text-gray-600 md:leading-none font-display">
                <span class="macaw-post-author">
                    {{#foreach authors}}<a href="/jako-ja/" class="text-gray-900 underline transition-colors duration-300 hover:text-accent">{{name}}</a>{{/foreach}}
                </span>
                <time class="feed-date" datetime="{{date format="DD-MM-YYYY"}}">
                    <span class="mx-2 bull">&bull;</span>
                    {{date published_at format="DD. MMM YYYY"}}
                </time>

                <!--<span class="visibility">
                    <span class="mx-2 bull">&bull;</span>
                    {{visibility}}
                </span>-->

                {{#if reading_time}}
                    <div class="feed-length">
                        <span class="mx-2 bull">&bull;</span>
                        {{reading_time minute="Čtení na minutku" minutes="Čtení na % min"}}
                    </div>
                {{/if}}
            </span>
        </header>

        {{!-- We check if the post has a feature image --}}
        {{#if feature_image}}
            <figure class="container mt-2 text-center md:mb-8 md:mt-10 gh-feature-image max-sm:p-0">

                <picture>
                    <source srcset="{{img_url feature_image size="post-full-s-x2"}} 2x,{{img_url feature_image
                                                                                     size="post-full-s"}} 1x" media="(max-width: 420px)" />
                    <source srcset="{{img_url feature_image size="post-full-m-x2"}} 2x,{{img_url feature_image
                                                                                     size="post-full-m"}} 1x" media="(max-width: 768px)" />
                    <source srcset="{{img_url feature_image size="post-full-x2"}} 2x,{{img_url feature_image
                                                                                     size="post-full"}} 1x" media="(max-width: 1024px)" />
                    <img srcset="{{img_url feature_image size="post-full-x2"}} 2x" src="{{img_url feature_image size="post-full"}}" alt="{{#if feature_image_alt}}{{feature_image_alt}}{{else}}{{title}}{{/if}}" class="w-full max-sm:rounded-none max-sm:w-full rounded-3xl" decoding="async" fetchpriority="high" />

                </picture>
                {{#if feature_image_caption}}
                    <figcaption>{{feature_image_caption}}</figcaption>
                {{/if}}
            </figure>
        {{/if}}

        {{!-- Content goes here --}}
        <div class="relative prose sm:prose-lg prose-md prose-headings:font-display prose-headings:mt-0 prose-headings:mb-2 prose-p:mt-0 prose-p:mb-6 sm:prose-p:mb-10 md:prose-p:mb-12 lg:prose-p:mb-14 xl:prose-p:mb-14 prose-h5:font-bold prose-h6:font-bold prose-img:rounded-3xl prose-ul:mt-0 prose-ul:mb-6 sm:prose-ul:mb-10 md:prose-ul:mb-12 lg:prose-ul:mb-14 xl:prose-ul:mb-14 prose-ol:mt-0 prose-ol:mb-6 sm:prose-ol:mb-10 md:prose-ol:mb-12 lg:prose-ol:mb-14 xl:prose-ol:mb-14 prose-li:pl-0 prose-li:mt-0 prose-a:underline hover:prose-a:no-underline prose-hr:mt-0 prose-hr:mb-6 sm:prose-hr:mb-10 md:prose-hr:mb-12 lg:prose-hr:mb-14 xl:prose-hr:mb-14 last:prose-li:mb-0 prose-macaw gh-content gh-canvas max-w-none">

                {{#if @custom.display_toc}}

                    <div class="mb-20 bg-gray-100 rounded-2xl">
                        <div class="px-10 py-8">
                            <h4 class="mb-8 text-xl toc-heading font-display">{{t "Table of contents"}}</h4>
                            <div class="gh-toc font-display"></div>
                        </div>
                    </div>

                {{/if}}

            {{#if access}}

                {{content}}

                {{#if @custom.display_share}}
                    <div class="not-prose">
                        {{> "share"}}
                    </div>
                {{/if}}

                <div class="divider-cherry mt-16"></div>

                {{!-- Hyvor komentáře - pouze v produkci --}}
                {{#match @site.url "!=" "http://localhost:2368"}}
                <section class="gh-post-comments mt-16" id="ghost-comments-root">
                    
                    {{!-- 1. Vykreslení HTML (Okamžité zobrazení pro rychlost) --}}
                    {{!-- DŮLEŽITÉ: id="hyvor-comments" musí zůstat, aby ho JS našel --}}
                    <hyvor-talk-comments
                        id="hyvor-comments"
                        website-id="14402"
                        page-id="{{id}}"
                        {{#if @member}}
                        sso-user='{"timestamp":{{date format="X"}},"id":"{{@member.uuid}}","name":"{{@member.name}}","email":"{{@member.email}}","picture_url":"{{@member.avatar_image}}"}'
                        {{/if}}
                    ></hyvor-talk-comments>

                    {{!-- 2. Načtení knihovny Hyvor --}}
                    <script async src="https://talk.hyvor.com/embed/embed.js" type="module"></script>

                    {{!-- 3. Napojení na GTM / Facebook Pixel --}}
                    <script>
                        // Počkáme, až bude DOM připravený (pro jistotu)
                        document.addEventListener("DOMContentLoaded", function() {
                            
                            // Najdeme ten HTML element podle ID, které jsme mu dali nahoře
                            const commentsElement = document.getElementById('hyvor-comments');
                            
                            // Inicializace DataLayeru, pokud ještě neexistuje
                            window.dataLayer = window.dataLayer || [];

                            if (commentsElement) {
                                // A. Nový komentář (FB Pixel: SubmitApplication nebo vlastní event)
                                commentsElement.addEventListener('comment:published', function(e) {
                                    window.dataLayer.push({
                                        'event': 'hyvor_comment',
                                        'comment_id': e.detail.id || '',
                                        'article_url': window.location.href,
                                        'article_title': document.title
                                    });
                                    console.log('GTM Event: hyvor_comment odeslán'); // Kontrola v konzoli
                                });

                                // B. Hodnocení komentáře (To se ti hodí pro engagement)
                                commentsElement.addEventListener('comment:voted', function(e) {
                                    window.dataLayer.push({
                                        'event': 'hyvor_vote',
                                        'comment_id': e.detail.comment?.id || '',
                                        'vote_type': e.detail.vote || '',
                                        'article_url': window.location.href
                                    });
                                });

                                // C. Reakce (Srdíčka, smajlíci...)
                                commentsElement.addEventListener('reaction', function(e) {
                                    window.dataLayer.push({
                                        'event': 'hyvor_reaction',
                                        'reaction_type': e.detail.type || '',
                                        'article_url': window.location.href,
                                        'article_title': document.title
                                    });
                                });

                                // D. Hvězdičkové hodnocení
                                commentsElement.addEventListener('rating', function(e) {
                                    window.dataLayer.push({
                                        'event': 'hyvor_rating',
                                        'rating_value': e.detail.rating || 0,
                                        'article_url': window.location.href,
                                        'article_title': document.title
                                    });
                                });
                            }
                        });
                    </script>
                </section>
                {{/match}}

            {{else}}

                <div class="macaw-post-sneak-peek fading">
                    {{{html}}}
                </div>

                {{> "content-cta"}}

            {{/if}}

            {{#if @custom.display_author_box}}

                <div class="relative px-8 pb-8 md:p-10 overflow-hidden pt-[4.5rem] lg:px-20 lg:pt-20 lg:pb-16 my-7 lg:my-14 grad-bg rounded-3xl macaw-authors not-prose">
                    {{#foreach authors}}
                        {{> "author"}}
                    {{/foreach}}
                </div>

            {{/if}}

            <div>
                {{#is "post"}}
                    <h2 class="no-toc pb-3 mb-16 text-lg md:text-base font-bold leading-none tracking-widest text-gray-900 uppercase border-b featured-title font-display">
                        Nespěcháš? Tak si dej tohle…
                    </h2>

                    <div class="grid grid-cols-1 gap-6 md:gap-8 gh-feed recommended-posts" aria-label="Doporučené články">
                        {{#get "posts" filter="id:-{{id}}+visibility:members" limit="1" order="random" as |vip|}}
                            {{#if vip}}
                                {{#foreach vip}}
                                    {{> "card-recommended"}}
                                {{/foreach}}
                            {{else}}
                                {{#get "posts" filter="id:-{{id}}+visibility:public+featured:true" limit="1" order="random" as |fallbackVip|}}
                                    {{#foreach fallbackVip}}
                                        {{> "card-recommended"}}
                                    {{/foreach}}
                                {{else}}
                                    {{#get "posts" filter="id:-{{id}}+visibility:public" limit="1" order="random" as |lastResort|}}
                                        {{#foreach lastResort}}
                                            {{> "card-recommended"}}
                                        {{/foreach}}
                                    {{/get}}
                                {{/get}}
                            {{/if}}
                        {{/get}}

                        {{#if tags}}
                            {{#get "posts" filter="tags:[{{tags[*].slug}}]+id:-{{id}}+visibility:public" limit="2" as |related|}}
                                {{#match pagination.total ">=" 2}}
                                    {{#foreach related}}
                                        {{> "card-recommended"}}
                                    {{/foreach}}
                                {{else}}
                                    {{#get "posts" filter="id:-{{../id}}+visibility:public" limit="2" order="random" as |randoms|}}
                                        {{#foreach randoms}}
                                            {{> "card-recommended"}}
                                        {{/foreach}}
                                    {{/get}}
                                {{/match}}
                            {{/get}}
                        {{else}}
                            {{#get "posts" filter="id:-{{id}}+visibility:public" limit="2" order="random" as |randoms|}}
                                {{#foreach randoms}}
                                    {{> "card-recommended"}}
                                {{/foreach}}
                            {{/get}}
                        {{/if}}

                    </div>

                    {{else}}
                        {{!-- PAGE --}}
                        <h2 class="no-toc pb-3 mb-8 text-lg md:text-base font-bold leading-none tracking-widest text-gray-900 uppercase border-b featured-title font-display border-b-gray-200">
                            Vybrala jsem pro tebe…
                        </h2>
                        <div class="grid grid-cols-1 gap-6 md:gap-8 gh-feed recommended-posts" aria-label="Doporučené články">
                            {{#get "posts" limit="3" order="random" as |randoms|}}
                                {{#foreach randoms}}
                                    {{> "card-recommended"}}
                                {{/foreach}}
                            {{/get}}
                        </div>
                {{/is}}
            </div>

            {{#match @site.recommendations_enabled}}
                <div class="mt-12 not-prose flex flex-col">
                    <h3 class="no-toc pb-2 mb-6 text-base font-bold leading-none tracking-widest text-gray-900 uppercase border-b featured-title font-display border-b-gray-200 ">{{t
                            "Recommendations"}}</h3>

                    {{recommendations limit="2"}}
                </div>
            {{/match}}


            <div id="read-depth-trigger"></div>

            <div class="gh-loadmore"></div>


            <noscript>
                <div class="gh-pagination">
                    <div class="gh-loadmore"></div>
                </div>
            </noscript>

        </div>

    </article>

{{/post}}


{{#if @custom.display_toc}}
    {{> "toc"}}
{{/if}}